Function Show-Help {
    Write-Output "Usage: ./nva_script_hz.ps1 -u URL"
    Write-Output ""
    Write-Output "-u <url>: IP or URL to nmap scan (WITHOUT HTTP(S)://)"
}

Function Get-Nva {
    param(
        [string]$url
    )
    Write-Output "Starting NVA scan..."
    Write-Output "URL: $url"
    Write-Output ""
    ping $url -n 5 | Out-File $url-ping.txt

    nmap -sP $url -oN $url-host.txt

    nmap -sV -sC -p- -v -Pn $url -oN $url-all-SYN.txt

    nmap -Pn -v -p 22 --script ssh2-enum-algos $url -oN $url-ssh2-enum-algos-22.txt
    nmap -Pn -v -p 22 --script ssh-auth-methods $url -oN $url-ssh-auth-methods-22.txt

    nmap -Pn -v -p 443 --script ssl-enum-ciphers $url -oN $url-ssl-enum-ciphers-443.txt
    nmap -Pn -v -p 443 --script ssl-cert $url -oN $url-ssl-cert-443.txt

    nmap -Pn -v -p 445, 137, 139 -script "smb-* and safe" $url -oN $url-smb-safe.txt

    nmap -Pn -v -p 3389 --script rdp-enum-encryption $url -oN $url-rdp-enum-encryption-3389.txt
    nmap -Pn -v -p 3389 --script rdp-ntlm-info $url -oN $url-rdp-ntlm-info-3389.txt

    nmap -Pn -p21 -sV -sC $url -oN $url-ftp-default.txt

    nmap -Pn -p53 -sV -sC $url -oN $url-dns-default.txt

    nmap -Pn -p 25, 465, 587, 2525 -sV -sC $url -oN $url-smtp-default.txt

    nmap -Pn -p123 --script ntp-info $url -oN $url-ntp-info.txt
    nmap -Pn -p123 --script ntp-monlist $url -oN $url-ntp-monlist.txt

    nmap -Pn -p23 --script telnet-encryption -v $url -oN $url-telnet-encryption.txt

    nmap -Pn -p 22, 443, 445, 137, 139, 3389, 21, 53, 25, 465, 587, 2525, 123, 23 -sV -sC $url -oN $url-all-workpaper-ports-default.txt

    python3 nmap-oneliner.py | Out-File statusofportsworkpaper.txt
}

# run the functions
if ( ($args[0] -eq "-u") -and ($null -ne $args[1]) ) {
    Get-Nva $args[1]
}
else {
    Show-Help
}
