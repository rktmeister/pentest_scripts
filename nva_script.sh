#!/bin/bash

function show_help {
    echo "usage:        $0 [ -u URL -o output file -w wordlist ]"
    echo " "
    echo "-u url:       IP or URL to nmap scan (WITHOUT HTTP(S)://)"
}

URL=""
PORT=""

while getopts "u:p:h:" opt; do
    case $opt in
    u)
        URL=$OPTARG
        ;;
    p)
        PORT=$OPTARG
        ;;
    h)
        show_help
        exit 0
        ;;
    \?)
        show_help
        exit 0
        ;;
    esac
done

echo "Target IP / URL: $URL"
echo "Ports: $PORT"
echo " "

if [[ -z $URL ]]; then
    echo "Please input IP / URL!"
    exit 1
else
    echo "Beginning NVA scan on $URL"
    echo ""
    ping "$URL" >"$URL"-ping.txt
    nmap -sP "$URL" -oN "$URL"-host.txt

    nmap -sV -sC -p- -v -Pn "$URL" -oN "$URL"-all-SYN.txt

    nmap -Pn -v -p 22 --script ssh2-enum-algos "$URL" -oN "$URL"-ssh2-enum-algos-22.txt
    nmap -Pn -v -p 22 --script ssh-auth-methods "$URL" -oN "$URL"-ssh-auth-methods-22.txt

    nmap -Pn -v -p 443 --script ssl-enum-ciphers "$URL" -oN "$URL"-ssl-enum-ciphers-443.txt
    nmap -Pn -v -p 443 --script ssl-cert "$URL" -oN "$URL"-ssl-cert-443.txt

    nmap -Pn -v -p 445,137,139 -script "smb-* and safe" "$URL" -oN "$URL"-smb-safe.txt

    nmap -Pn -v -p 3389 --script rdp-enum-encryption "$URL" -oN "$URL"-rdp-enum-encryption-3389.txt
    nmap -Pn -v -p 3389 --script rdp-ntlm-info "$URL" -oN "$URL"-rdp-ntlm-info-3389.txt

    nmap -Pn -p21 -sV -sC "$URL" -oN "$URL"-ftp-default.txt

    nmap -Pn -p53 -sV -sC "$URL" -oN "$URL"-dns-default.txt

    nmap -Pn -p 25,465,587,2525 -sV -sC "$URL" -oN "$URL"-smtp-default.txt

    nmap -Pn -p123 --script ntp-info "$URL" -oN "$URL"-ntp-info.txt
    nmap -Pn -p123 --script ntp-monlist "$URL" -oN "$URL"-ntp-monlist.txt

    nmap -Pn -p23 --script telnet-encryption -v "$URL" -oN "$URL"-telnet-encryption.txt

    nmap -Pn -p 22,443,445,137,139,3389,21,53,25,465,587,2525,123,23 -sV -sC "$URL" -oN "$URL"-all-workpaper-ports-default.txt

    python3 nmap-oneliner.py "$URL" > statusofportsworkpaper.txt

fi
